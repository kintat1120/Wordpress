{% extends "base.twig" %}

{% block content %}
<script>
//console.log($.cookie());

/*
var cookies = $.cookie();
for(var cookie in cookies) {
    $.removeCookie(cookie);
}
*/

var firstSlideIndicator = 0;
//Show first question
$(function() {
    var html = "";
    $.cookie("oldSection",["sectionA"]);
    html+= "<div class='carousel-item active' id='firstItem'>"
    html+= "<div class='container'>"
    html+= "<div class='row justify-content-center'>"
    html+= "<div class='col-9 col-md-9 col-xl-8 bg-white shadow p-4' style='border-radius:30px;'>"
    html+= "<strong class='fs-2 white-bg-title'>離婚事宜</strong>"
    html+= "</div>"
    html+= "</div>"
    $.getJSON('http://127.0.0.1/wordpress/wp-content/uploads/2021/06/form.json', function(data) {
        $.each(data.form.sectionA, function(index, items) {
            html+="<div class='tab row justify-content-center mt-5'>";
            html+="<div class='col-9 col-md-9 col-xl-8 bg-white shadow p-4 white-bg-content' style='border-radius:30px;'>";
            html+="<p><strong class='fs-5'>"+items.questionIndex+") "+items.question+"</strong></p>";
            html+="<div class='radio-margin'>";
            $.each(items.answer, function(answerIndex, answers) {
                html+="<div class='form-check'>";
                html+="<input class='form-check-input radio-style' type='radio' name='"+items.questionIndex+"' id='"+answers.txt+"' value='"+answers.next+"' priority="+answers.priority+">";
                html+="<label class='form-check-label' for='validationFormCheck2'>";
                html+="<strong class='fs-5'>"+answers.txt+"</strong>";
                html+="</label>";
                if(answers.inputField){
                    //html+="<input type='text' class='form-control h-75 pr-0 py-1 input-style' style='border:none;' id='other' name='other'>"
                    html+="<input type='text' class='form-control h-75 pr-0 py-1 input-style' id='"+items.questionIndex+"_"+answers.txt+"'>";
                }
                html+="</div>";
                if(answers.supplementaryAnswer){
                    $.each(answers.supplementaryAnswer, function(supplementaryAnswerIndex, supplementaryAns) {
                        html+="<div class='form-check form-checkbox radio-margin'>"
                        html+="<input class='form-check-input radio-style' type='checkbox' id='"+supplementaryAns.txt+"'>"
                        html+="<label class='form-check-label' for='validationFormCheck3'>"
                        html+="<strong>"+supplementaryAns.txt+"</strong>"
                        html+="</label>"
                        if(supplementaryAns.inputField){
                            //html+="<input type='text' class='form-control h-75 pr-0 py-1 input-style' style='border:none;' id='other' name='other'>"
                            html+="<input type='text' class='form-control h-75 pr-0 py-1 input-style' id='"+items.questionIndex+"_"+answers.txt+"_"+supplementaryAns.txt+"'>";
                        }
                        html+="</div>"
                    });
                }
                //console.log(answers.txt)
            });
            html+="</div></div></div>";
        });
        html+="</div></div>";
        $("#next").show();
        $("#prev").hide();
        $("#submit").hide();
        //console.log(html)
        $( ".carousel-inner" ).append(html);
    });
});

//next
$(function(){
    $('#carouselExampleControls').delegate("#next","click", function(){
        var newSection = "";
        var sectionPriority_temp = 0;
        var sectionPriority = 0;
        var sectionCreated = false;
        var finalSection = false;
        //console.log($.cookie('oldSection'))
        $('input:checked', '.carousel-inner').each(function() {
            $.cookie($(this).attr('name'), $(this).attr('id')); //cookie(name, value)
            sectionPriority = parseInt($(this).attr('priority'));
            if(sectionPriority > sectionPriority_temp){
                newSection = $(this).attr('value');
                sectionPriority_temp = sectionPriority;
            }
        });
        console.log($.cookie());
        if (newSection == "noSection"){
            finalSection = true;
        }
        var html = "";
        var existedSection = $.cookie("oldSection").split(",");
        $.each(existedSection, function(ind, val) {
            if (newSection == val){
                sectionCreated = true;
            }
        });
        if(sectionCreated && finalSection ){
            $("#submit").show();
            $("#next").hide();
        }
        if(!sectionCreated && finalSection){
            html+= "<div class='carousel-item' id='submitPage'>";
            html+= "<div class='container'>";
            html+= "<div class='row justify-content-center'>"
            html+= "<div class='col-9 col-md-9 col-xl-8 bg-white shadow p-4' style='border-radius:30px;'>"
            html+= "<strong class='fs-2 white-bg-title'>離婚事宜</strong>"
            html+= "</div>"
            html+= "</div>"
            html+="<div class='tab row justify-content-center mt-5'>";
            html+="<div class='col-9 col-md-9 col-xl-8 bg-white shadow p-4 white-bg-content' style='border-radius:30px;'>";
            html+="<strong>問卷已完成，你要確定提交嗎?</strong>"
            html+="</div></div></div></div>"
            $( ".carousel-inner" ).append(html);
            $.cookie('oldSection', $.cookie('oldSection') + ","+newSection);
            $("#submit").show();
            $("#next").hide();
        }
        if (!sectionCreated && !finalSection){
            $.getJSON('http://127.0.0.1/wordpress/wp-content/uploads/2021/06/form.json', function(data) {
                html+= "<div class='carousel-item'>";
                html+= "<div class='container'>";
                html+= "<div class='row justify-content-center'>"
                html+= "<div class='col-9 col-md-9 col-xl-8 bg-white shadow p-4' style='border-radius:30px;'>"
                html+= "<strong class='fs-2 white-bg-title'>離婚事宜</strong>"
                html+= "</div>"
                html+= "</div>"
                $.each(data.form[newSection], function(index, items) {
                    html+="<div class='tab row justify-content-center mt-5'>";
                    html+="<div class='col-9 col-md-9 col-xl-8 bg-white shadow p-4 white-bg-content' style='border-radius:30px;'>";
                    html+="<p><strong class='fs-5'>"+items.questionIndex+") "+items.question+"</strong></p>";
                    html+="<div class='radio-margin'>";
                    $.each(items.answer, function(answerIndex, answers) {
                        html+="<div class='form-check'>";
                        html+="<input class='form-check-input radio-style' type='radio' name='"+items.questionIndex+"' id='"+answers.txt+"' value='"+answers.next+"' priority="+answers.priority+">";
                        html+="<label class='form-check-label' for='flexRadioDefault1'>";
                        html+="<strong class='fs-5'>"+answers.txt+"</strong>";
                        html+="</label>";
                        if(answers.inputField){
                            //html+="<input type='text' class='form-control h-75 pr-0 py-1 input-style' style='border:none;' id='other' name='other'>"
                            html+="<input type='text' class='form-control h-75 pr-0 py-1 input-style' id='"+items.questionIndex+"_"+answers.txt+"'>";
                        }
                        html+="</div>";
                        if(answers.supplementaryAnswer){
                            $.each(answers.supplementaryAnswer, function(supplementaryAnswerIndex, supplementaryAns) {
                                html+="<div class='form-check form-checkbox radio-margin'>"
                                html+="<input class='form-check-input radio-style' type='checkbox' id='"+supplementaryAns.txt+"'>"
                                html+="<label class='form-check-label' for='flexCheckDefault'>"
                                html+="<strong>"+supplementaryAns.txt+"</strong>"
                                html+="</label>"
                                if(supplementaryAns.inputField){
                                    //html+="<input type='text' class='form-control h-75 pr-0 py-1 input-style' style='border:none;' id='other' name='other'>"
                                    html+="<input type='text' class='form-control h-75 pr-0 py-1 input-style' id='"+items.questionIndex+"_"+answers.txt+"_"+supplementaryAns.txt+"'>";
                                }
                                html+="</div>"
                            });
                        }
                        //console.log(answers.txt)
                    });
                    html+="</div></div></div>";
                });
                html+= "</div></div>";
                $( ".carousel-inner" ).append(html);
                if(firstSlideIndicator==0){
                    $('#carouselExampleControls').carousel('next');
                    $('#carouselExampleControls').carousel('pause');
                    firstSlideIndicator++;
                }
                $.cookie('oldSection', $.cookie('oldSection') + ","+newSection);
            });
            $("#prev").show();
            $("#next").show();
        }
    });
});
//Previous
$(function() {
    $('#carouselExampleControls').delegate("#prev","click", function(){
        $("#next").show();
        $("#submit").hide();
        if($( "#firstItem" ).hasClass( "carousel-item.active" )){$("#prev").hide();}
    });
});
</script>
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-12 col-md-12 col-xl-10">
            <div id="carouselExampleControls" class="carousel slide" data-ride="carousel" data-interval="false">
                <div class="carousel-inner">
                </div>
                <div class="mt-5" style="float:right;">
                    <a href="#carouselExampleControls" style="text-decoration:none;" role="button" data-slide="prev" id="prev">
                        <button type="button" class="btn btn-success">上一題</button>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a href="#carouselExampleControls" style="text-decoration:none;" role="button" data-slide="next" id="next">
                        <button type="button" class="btn btn-success">下一題</button>                    
                        <span class="sr-only">Next</span> <!--Change to button later-->
                    </a>
                    <a href="#carouselExampleControls" style="text-decoration:none;" role="button" data-slide="next" id="submit">
                        <button type="button" class="btn btn-success">提交</button>                    
                        <span class="sr-only">Submit</span> <!--Change to button later-->
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
